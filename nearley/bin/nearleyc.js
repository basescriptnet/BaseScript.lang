var fs=require("fs"),nearley=require("../lib/nearley.js"),opts=require("commander"),Compile=require("../lib/compile.min.js"),StreamWrapper=require("../lib/stream.js"),version=require("../package.json").version;opts.version(version,"-v, --version").arguments("<file.ne>").option("-o, --out [filename.js]","File to output to (defaults to stdout)",!1).option("-e, --export [name]","Variable to set parser to","grammar").option("-q, --quiet","Suppress linter").option("--nojs","Do not compile postprocessors").parse(process.argv);
var input=opts.args[0]?fs.createReadStream(opts.args[0]):process.stdin,output=opts.out?fs.createWriteStream(opts.out):process.stdout,parserGrammar=nearley.Grammar.fromCompiled(require("../lib/nearley-language-bootstrapped.js")),parser=new nearley.Parser(parserGrammar),generate=require("../lib/generate.min.js"),lint=require("../lib/lint.js");
input.pipe(new StreamWrapper(parser)).on("finish",function(){parser.feed("\n");var a=Compile(parser.results[0],Object.assign({version},opts));opts.quiet||lint(a,{out:process.stderr,version});output.write(generate(a,opts.export))});
